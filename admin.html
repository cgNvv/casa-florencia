<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casa Florencia - Panel de Administración</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #DDD9D7;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #e8f3ea 0%, #fef5f2 100%);
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        h1 {
            color: #CA8B79;
            font-size: 2.5em;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .back-link {
            display: inline-block;
            margin-top: 10px;
            color: #6b5b52;
            text-decoration: none;
            font-size: 0.9em;
        }

        .back-link:hover {
            color: #CA8B79;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #6b5b52;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            color: #CA8B79;
            font-size: 2em;
            font-weight: 700;
        }

        .stat-card .subtitle {
            color: #999;
            font-size: 0.8em;
            margin-top: 5px;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Forms Column */
        .forms-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Purchase form specific */
        .form-section.purchase-form {
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
            border: 2px solid #f0e0e0;
        }

        .form-section.purchase-form h2 {
            color: #dc3545;
        }

        .btn-add.btn-purchase {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-add.btn-purchase:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        /* Tabs for tables */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 8px 16px;
            border: 2px solid #BACFBF;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #CA8B79;
            border-color: #CA8B79;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            border-color: #CA8B79;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Section */
        .form-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .form-section h2 {
            color: #CA8B79;
            font-size: 1.5em;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #6b5b52;
            font-weight: 600;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #BACFBF;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #F39B73;
        }

        .btn-add {
            background: linear-gradient(135deg, #F39B73 0%, #CA8B79 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 155, 115, 0.4);
        }

        /* Table Section */
        .table-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-section h2 {
            color: #CA8B79;
            font-size: 1.5em;
            font-weight: 600;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group select {
            width: auto;
            padding: 8px 12px;
            font-size: 0.9em;
        }

        .btn-clear {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-clear:hover {
            background: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f8f8;
            color: #6b5b52;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #333;
            font-size: 0.95em;
        }

        .profit-positive {
            color: #28a745;
            font-weight: 600;
        }

        .profit-negative {
            color: #dc3545;
            font-weight: 600;
        }

        .btn-delete {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            transition: transform 0.2s ease;
        }

        .btn-delete:hover {
            transform: scale(1.2);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* Responsive table */
        .table-wrapper {
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-card .value {
                font-size: 1.5em;
            }

            h1 {
                font-size: 1.8em;
            }

            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .filter-group {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Panel de Administración</h1>
            <a href="index.html" class="back-link">← Volver al sitio</a>
        </header>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Hoy</h3>
                <div class="value" id="todayEarnings">₲0</div>
                <div class="subtitle" id="todayCount">0 servicios</div>
            </div>
            <div class="stat-card">
                <h3>Esta Semana</h3>
                <div class="value" id="weekEarnings">₲0</div>
                <div class="subtitle" id="weekCount">0 servicios</div>
            </div>
            <div class="stat-card">
                <h3>Este Mes</h3>
                <div class="value" id="monthEarnings">₲0</div>
                <div class="subtitle" id="monthCount">0 servicios</div>
            </div>
            <div class="stat-card">
                <h3>Compras (Mes)</h3>
                <div class="value" id="monthPurchases" style="color: #dc3545;">₲0</div>
                <div class="subtitle" id="purchaseCount">0 compras</div>
            </div>
            <div class="stat-card">
                <h3>Ganancia Neta (Mes)</h3>
                <div class="value" id="monthProfit">₲0</div>
                <div class="subtitle" id="profitMargin">0% margen</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="forms-column">
                <!-- Add Service Form -->
                <div class="form-section">
                    <h2>Agregar Servicio</h2>
                    <form id="serviceForm">
                        <div class="form-group">
                            <label for="serviceDate">Fecha</label>
                            <input type="date" id="serviceDate" required>
                        </div>

                        <div class="form-group">
                            <label for="serviceType">Tipo de Servicio</label>
                            <select id="serviceType" required>
                                <option value="">Seleccionar...</option>
                                <option value="Manicura Clásica" data-price="50000">Manicura Clásica - ₲50.000</option>
                                <option value="Semipermanente" data-price="80000">Semipermanente - ₲80.000</option>
                                <option value="Acrílicas" data-price="200000">Acrílicas - ₲200.000</option>
                                <option value="Gel" data-price="150000">Gel - ₲150.000</option>
                                <option value="Soft Gel" data-price="120000">Soft Gel - ₲120.000</option>
                                <option value="Diseños Especiales" data-price="0">Diseños Especiales</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="servicePrice">Precio Cobrado (₲)</label>
                            <input type="number" id="servicePrice" placeholder="Ej: 50000" required>
                        </div>

                        <div class="form-group">
                            <label for="serviceCost">Costo de Materiales (₲)</label>
                            <input type="number" id="serviceCost" placeholder="Ej: 10000" value="0">
                        </div>

                        <div class="form-group">
                            <label for="serviceNotes">Notas (opcional)</label>
                            <input type="text" id="serviceNotes" placeholder="Cliente, detalles, etc.">
                        </div>

                        <button type="submit" class="btn-add">Agregar Servicio</button>
                    </form>
                </div>

                <!-- Add Purchase Form -->
                <div class="form-section purchase-form">
                    <h2>Agregar Compra</h2>
                    <form id="purchaseForm">
                        <div class="form-group">
                            <label for="purchaseDate">Fecha</label>
                            <input type="date" id="purchaseDate" required>
                        </div>

                        <div class="form-group">
                            <label for="purchaseItem">Artículo</label>
                            <input type="text" id="purchaseItem" placeholder="Ej: Esmaltes, Acetona, etc." required>
                        </div>

                        <div class="form-group">
                            <label for="purchasePrice">Precio Total (₲)</label>
                            <input type="number" id="purchasePrice" placeholder="Ej: 50000" required>
                        </div>

                        <div class="form-group">
                            <label for="purchaseAmount">Cantidad</label>
                            <input type="number" id="purchaseAmount" placeholder="Ej: 5" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label for="purchaseNotes">Notas (opcional)</label>
                            <input type="text" id="purchaseNotes" placeholder="Proveedor, detalles, etc.">
                        </div>

                        <button type="submit" class="btn-add btn-purchase">Agregar Compra</button>
                    </form>
                </div>
            </div>

            <!-- Tables Section -->
            <div class="table-section">
                <div class="table-header">
                    <h2>Historial</h2>
                    <div class="filter-group">
                        <select id="filterPeriod">
                            <option value="all">Todos</option>
                            <option value="today">Hoy</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                        </select>
                        <button class="btn-clear" onclick="clearAllData()">Borrar Todo</button>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('services')">Servicios</button>
                    <button class="tab-btn" onclick="switchTab('purchases')">Compras</button>
                </div>

                <!-- Services Table -->
                <div id="servicesTab" class="tab-content active">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Servicio</th>
                                    <th>Precio</th>
                                    <th>Costo</th>
                                    <th>Ganancia</th>
                                    <th>Notas</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="servicesTableBody">
                                <tr class="no-data">
                                    <td colspan="7">No hay servicios registrados</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Purchases Table -->
                <div id="purchasesTab" class="tab-content">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Artículo</th>
                                    <th>Precio</th>
                                    <th>Cantidad</th>
                                    <th>Notas</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="purchasesTableBody">
                                <tr class="no-data">
                                    <td colspan="6">No hay compras registradas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data from localStorage
        let services = JSON.parse(localStorage.getItem('casaFlorenciaServices')) || [];
        let purchases = JSON.parse(localStorage.getItem('casaFlorenciaPurchases')) || [];

        // Set default dates to today
        document.getElementById('serviceDate').valueAsDate = new Date();
        document.getElementById('purchaseDate').valueAsDate = new Date();

        // Auto-fill price when service is selected
        document.getElementById('serviceType').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const price = selectedOption.getAttribute('data-price');
            if (price && price !== '0') {
                document.getElementById('servicePrice').value = price;
            } else {
                document.getElementById('servicePrice').value = '';
            }
        });

        // Service form submission
        document.getElementById('serviceForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const service = {
                id: Date.now(),
                date: document.getElementById('serviceDate').value,
                type: document.getElementById('serviceType').value,
                price: parseInt(document.getElementById('servicePrice').value) || 0,
                cost: parseInt(document.getElementById('serviceCost').value) || 0,
                notes: document.getElementById('serviceNotes').value
            };

            services.push(service);
            saveData();
            renderServicesTable();
            updateStats();

            // Reset form but keep date
            const currentDate = document.getElementById('serviceDate').value;
            this.reset();
            document.getElementById('serviceDate').value = currentDate;
        });

        // Purchase form submission
        document.getElementById('purchaseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const purchase = {
                id: Date.now(),
                date: document.getElementById('purchaseDate').value,
                item: document.getElementById('purchaseItem').value,
                price: parseInt(document.getElementById('purchasePrice').value) || 0,
                amount: parseInt(document.getElementById('purchaseAmount').value) || 1,
                notes: document.getElementById('purchaseNotes').value
            };

            purchases.push(purchase);
            saveData();
            renderPurchasesTable();
            updateStats();

            // Reset form but keep date
            const currentDate = document.getElementById('purchaseDate').value;
            this.reset();
            document.getElementById('purchaseDate').value = currentDate;
            document.getElementById('purchaseAmount').value = '1';
        });

        // Save to localStorage
        function saveData() {
            localStorage.setItem('casaFlorenciaServices', JSON.stringify(services));
            localStorage.setItem('casaFlorenciaPurchases', JSON.stringify(purchases));
        }

        // Delete a service
        function deleteService(id) {
            if (confirm('¿Eliminar este servicio?')) {
                services = services.filter(s => s.id !== id);
                saveData();
                renderServicesTable();
                updateStats();
            }
        }

        // Delete a purchase
        function deletePurchase(id) {
            if (confirm('¿Eliminar esta compra?')) {
                purchases = purchases.filter(p => p.id !== id);
                saveData();
                renderPurchasesTable();
                updateStats();
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('¿Estás seguro de que quieres borrar TODOS los datos? Esta acción no se puede deshacer.')) {
                services = [];
                purchases = [];
                saveData();
                renderServicesTable();
                renderPurchasesTable();
                updateStats();
            }
        }

        // Format currency
        function formatCurrency(amount) {
            return '₲' + amount.toLocaleString('es-PY');
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('es-PY', {
                day: '2-digit',
                month: '2-digit',
                year: '2-digit'
            });
        }

        // Filter by period helper
        function filterByPeriod(items) {
            const filter = document.getElementById('filterPeriod').value;
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            return items.filter(item => {
                const itemDate = new Date(item.date + 'T00:00:00');

                switch(filter) {
                    case 'today':
                        return itemDate.getTime() === today.getTime();
                    case 'week':
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return itemDate >= weekAgo;
                    case 'month':
                        return itemDate.getMonth() === now.getMonth() &&
                               itemDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });
        }

        // Render services table
        function renderServicesTable() {
            const tbody = document.getElementById('servicesTableBody');
            const filteredServices = filterByPeriod(services);

            if (filteredServices.length === 0) {
                tbody.innerHTML = '<tr class="no-data"><td colspan="7">No hay servicios registrados</td></tr>';
                return;
            }

            // Sort by date (newest first)
            filteredServices.sort((a, b) => new Date(b.date) - new Date(a.date));

            tbody.innerHTML = filteredServices.map(service => {
                const profit = service.price - service.cost;
                const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';

                return `
                    <tr>
                        <td>${formatDate(service.date)}</td>
                        <td>${service.type}</td>
                        <td>${formatCurrency(service.price)}</td>
                        <td>${formatCurrency(service.cost)}</td>
                        <td class="${profitClass}">${formatCurrency(profit)}</td>
                        <td>${service.notes || '-'}</td>
                        <td>
                            <button class="btn-delete" onclick="deleteService(${service.id})">×</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Render purchases table
        function renderPurchasesTable() {
            const tbody = document.getElementById('purchasesTableBody');
            const filteredPurchases = filterByPeriod(purchases);

            if (filteredPurchases.length === 0) {
                tbody.innerHTML = '<tr class="no-data"><td colspan="6">No hay compras registradas</td></tr>';
                return;
            }

            // Sort by date (newest first)
            filteredPurchases.sort((a, b) => new Date(b.date) - new Date(a.date));

            tbody.innerHTML = filteredPurchases.map(purchase => {
                return `
                    <tr>
                        <td>${formatDate(purchase.date)}</td>
                        <td>${purchase.item}</td>
                        <td class="profit-negative">${formatCurrency(purchase.price)}</td>
                        <td>${purchase.amount}</td>
                        <td>${purchase.notes || '-'}</td>
                        <td>
                            <button class="btn-delete" onclick="deletePurchase(${purchase.id})">×</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Switch tabs
        function switchTab(tab) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Update statistics
        function updateStats() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);

            // Today's stats
            const todayServices = services.filter(s => {
                const date = new Date(s.date + 'T00:00:00');
                return date.getTime() === today.getTime();
            });
            const todayEarnings = todayServices.reduce((sum, s) => sum + s.price, 0);
            document.getElementById('todayEarnings').textContent = formatCurrency(todayEarnings);
            document.getElementById('todayCount').textContent = `${todayServices.length} servicio${todayServices.length !== 1 ? 's' : ''}`;

            // Week's stats
            const weekServices = services.filter(s => {
                const date = new Date(s.date + 'T00:00:00');
                return date >= weekAgo;
            });
            const weekEarnings = weekServices.reduce((sum, s) => sum + s.price, 0);
            document.getElementById('weekEarnings').textContent = formatCurrency(weekEarnings);
            document.getElementById('weekCount').textContent = `${weekServices.length} servicio${weekServices.length !== 1 ? 's' : ''}`;

            // Month's stats for services
            const monthServices = services.filter(s => {
                const date = new Date(s.date + 'T00:00:00');
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            });
            const monthEarnings = monthServices.reduce((sum, s) => sum + s.price, 0);
            const monthServiceCosts = monthServices.reduce((sum, s) => sum + s.cost, 0);

            // Month's stats for purchases
            const monthPurchases = purchases.filter(p => {
                const date = new Date(p.date + 'T00:00:00');
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            });
            const monthPurchaseTotal = monthPurchases.reduce((sum, p) => sum + p.price, 0);

            // Calculate net profit (earnings - service costs - purchases)
            const monthProfit = monthEarnings - monthServiceCosts - monthPurchaseTotal;
            const profitMargin = monthEarnings > 0 ? Math.round((monthProfit / monthEarnings) * 100) : 0;

            document.getElementById('monthEarnings').textContent = formatCurrency(monthEarnings);
            document.getElementById('monthCount').textContent = `${monthServices.length} servicio${monthServices.length !== 1 ? 's' : ''}`;
            document.getElementById('monthPurchases').textContent = formatCurrency(monthPurchaseTotal);
            document.getElementById('purchaseCount').textContent = `${monthPurchases.length} compra${monthPurchases.length !== 1 ? 's' : ''}`;
            document.getElementById('monthProfit').textContent = formatCurrency(monthProfit);
            document.getElementById('profitMargin').textContent = `${profitMargin}% margen`;
        }

        // Filter change event
        document.getElementById('filterPeriod').addEventListener('change', function() {
            renderServicesTable();
            renderPurchasesTable();
        });

        // Initial render
        renderServicesTable();
        renderPurchasesTable();
        updateStats();
    </script>
</body>
</html>
